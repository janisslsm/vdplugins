(function(p,r,i,m,R,k){"use strict";var u=void 0;const y=i.findByProps("canUseEmojisEverywhere"),{getCurrentUser:j}=i.findByStoreName("UserStore");var z=[m.instead("canUseEmojisEverywhere",y,function(e,t){if(j?.().premiumType!==null)return t.apply(u,e);var o=new Error().stack;return o?.includes("at EmojiPicker")?!0:t.apply(u,e)}),m.instead("canUseAnimatedEmojis",y,function(e,t){if(j?.().premiumType!==null)return t.apply(u,e);var o=new Error().stack;return o?.includes("at EmojiPicker")?!0:t.apply(u,e)})];const{getCustomEmojiById:T}=i.findByStoreName("EmojiStore"),{getGuildId:B}=i.findByStoreName("SelectedGuildStore"),P=/<a?:(\w+):(\d+)>/i;function U(e,t){const o=e.matchAll(/<a?:(\w+):(\d+)>/gi),s=[];for(const a of o){const n=T(a[2]);if(n.guildId!=B()||n.animated){e=e.replace(a[0],"");const c=n?.url??`https://cdn.discordapp.com/emojis/${n.id}.webp?size=44&animated=${n.animated}`,d=n.animated?`&animated=${n.animated}`:"";r.storage.hyperLink===!0?s.push(`[${n.name}](${c.split("?")[0]}?size=${t}&name=${n.name}${d})`):s.push(`${c.split("?")[0]}?size=${t}&name=${n.name}${d}`)}}return{newContent:e.trim(),extractedEmojis:s}}function h(e){if(!e.content.match(P))return;const{newContent:t,extractedEmojis:o}=U(e.content,r.storage.emojiSize);e.content=t,o.length>0&&(e.content+=`
`+o.join(`
`)),e.invalidEmojis=[]}const C=i.findByProps("sendMessage","receiveMessage"),E=i.findByProps("uploadLocalFiles"),{getCurrentUser:v}=i.findByStoreName("UserStore"),$=[m.before("sendMessage",C,function(e){v?.().premiumType===null&&h(e[1])})];E?.uploadLocalFiles!==void 0&&$.push(m.before("uploadLocalFiles",E,function(e){v?.().premiumType===null&&h(e[0].parsedMessage)}));var L=[...$];const{getCustomEmojiById:M}=i.findByStoreName("EmojiStore"),S=i.findByName("RowManager"),l=/https:\/\/cdn.discordapp.com\/emojis\/(\d+)\.\w+/;var N=[m.before("generate",S.prototype,function([e]){if(e.rowType!==1)return;let t=e.message.content;if(!t?.length)return;const o=t.match(l)?.index;if(o===void 0)return;const s=t.slice(o).trim().split(`
`);if(!s.every(function(n){return n.match(l)}))return;for(t=t.slice(0,o);t.indexOf("  ")!==-1;)t=t.replace("  ",` ${s.shift()} `);t=t.trim(),s.length&&(t+=` ${s.join(" ")}`);const a=e.message.embeds;for(let n=0;n<a.length;n++){const c=a[n];c.type==="image"&&c.url.match(l)&&a.splice(n--,1)}e.message.content=t,e.__realmoji=!0}),m.after("generate",S.prototype,function([e],t){if(e.rowType!==1||e.__realmoji!==!0)return;const{content:o}=t.message;if(!Array.isArray(o))return;const s=o.every(function(a){return a.type==="link"&&a.target.match(l)||a.type==="text"&&a.content===" "});for(let a=0;a<o.length;a++){const n=o[a];if(n.type!=="link")continue;const c=n.target.match(l);if(!c)continue;const d=n.target.split("&"),g=`${c[0]}?size=128`;let f=M(c[1])?.name;f===void 0&&(f="<realmoji>"),d[1]?.startsWith("name")&&(f=d[1].replace("name=","")),o[a]={type:"customEmoji",id:c[1],alt:f,src:n.target.includes("animated=true")?g.replace("webp","gif"):g,frozenSrc:g.replace("gif","webp"),jumboable:s?!0:void 0}}})];const{TableRow:H,TableSwitchRow:b,TableRadioGroup:_,TableRadioRow:I,TableRowGroup:w}=i.findByProps("TableRow"),{Stack:x}=i.findByProps("Stack"),A={Tiny:16,Small:32,Medium:48,Large:64,Huge:96,Jumbo:128},G="https://cdn.discordapp.com/emojis/926602689213767680.webp";function V(){return k.useProxy(r.storage),React.createElement(x,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(_,{title:"Emoji size",defaultValue:r.storage.emojiSize.toString(),onChange:function(e){return r.storage.emojiSize=parseInt(e)}},Object.entries(A).map(function([e,t]){return React.createElement(I,{label:e,subLabel:t,key:t.toString(),value:t.toString()})})),React.createElement(w,{title:"Preview"},React.createElement(R.ReactNative.Image,{source:{uri:`${G}?size=${r.storage.emojiSize}`,width:r.storage.emojiSize,height:r.storage.emojiSize}})),React.createElement(w,{title:"User Profile",titleStyleType:"no_border"},React.createElement(b,{label:"Use hyperlinks when sending fake emojis",onValueChange:function(e){r.storage.hyperLink=e},value:r.storage.hyperLink}),React.createElement(b,{label:"Transform fake emojis into real ones",onValueChange:function(e){r.storage.transformEmoji=e},value:r.storage.transformEmoji})))}r.storage.emojiSize??=48,r.storage.hyperLink??=!0,r.storage.transformEmoji??=!0;const F=[...z,...L,...N];var O={settings:V,onUnload:function(){return F.forEach(function(e){return e()})}};return p.default=O,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.storage);
