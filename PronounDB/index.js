(function(P,u,e,D,r,X,l,E,d,J){"use strict";var y={Failed:l.getAssetIDByName("Small"),Delete:l.getAssetIDByName("ic_message_delete"),Copy:l.getAssetIDByName("toast_copy_link"),Open:l.getAssetIDByName("ic_leave_stage"),Clipboard:l.getAssetIDByName("pending-alert"),Clock:l.getAssetIDByName("clock"),Pronoun:l.getAssetIDByName("ic_accessibility_24px"),Settings:{Toasts:{Settings:l.getAssetIDByName("ic_selection_checked_24px"),Failed:l.getAssetIDByName("ic_close_circle_24px")},Initial:l.getAssetIDByName("coffee"),Update:l.getAssetIDByName("discover"),Locale:l.getAssetIDByName("ic_locale_24px"),External:l.getAssetIDByName("ic_raised_hand_list"),Edit:l.getAssetIDByName("ic_edit_24px")}},R={shadow:function(t=.1){return{shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:t,shadowRadius:4.65,elevation:8}},displayToast:function(t,n){e.toasts.open({content:n=="clipboard"?`Copied ${t} to clipboard.`:t,source:n=="clipboard"?y.Clipboard:y.Settings.Initial})}};function _(t,n,a,i,o){try{return t(...n)}catch(s){console.warn(`[${a}] The following error happened when trying to ${i} ${o??"unspecificied label"}: ${s}`);return}}const N=function(t,n,a,i){return _(function(){if(t){t.length++,a++;for(let o=t.length-1;o>=a;o--)t[o]=t[o-1];return t[a-1]=n,t.length}},[t,n,a],r.manifest.name,"insert an item at",i)};var O={mapItem:function(t,n,a){return _(function(){let i=[];for(let o=0;o<t.length;o++)N(i,n(t[o],o,t),i.length);return i},[t,n],r.manifest.name,"map an array at",a)},insertItem:N},c={map:{},queue:[],fetching:!1,referenceMap:{hh:"he/him",hi:"he/it",hs:"he/she",ht:"he/they",ih:"it/him",ii:"it/its",is:"it/she",it:"it/they",shh:"she/he",sh:"she/her",si:"she/it",st:"she/they",th:"they/he",ti:"they/it",ts:"they/she",tt:"they/them",any:"any",other:"other",ask:"ask",avoid:"avoid, use name",unspecified:"unspecified"},async updateQueuedPronouns(){var t=this;if(this.queue.length<=0||this.fetching)return;const n=this.queue.splice(0,49),a=function(s){return t.queue.length<=0?s:t.map[s]?a(t.queue.shift()):s};for(const s of n)this.map[s]&&(n[s]=a(s));this.fetching=!0;const i=await(await fetch(`https://pronoundb.org/api/v1/lookup-bulk?platform=discord&ids=${n.join(",")}`,{method:"GET",headers:{Accept:"application/json","X-PronounDB-Source":"Vendetta"}})).json(),o=Object.fromEntries(Object.entries(i).filter(function([s,b]){return!isNaN(+s)}));Object.assign(this.map,o),this.fetching=!1,this.queue.length>0&&this.updateQueuedPronouns()}},S={plugin:{source:"https://github.com/acquitelol/vd-pronoun-db",pronoundb:"https://pronoundb.org/"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};const{View:L,Text:U,TouchableOpacity:Z}=E.General,{useThemeContext:ee}=u.findByProps("useThemeContext"),te=u.find(function(t){return t.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??u.find(function(t){return t.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},ae=u.findByName("UserProfileSection"),{UserProfileGradientCard:ne}=u.findByProps("UserProfileGradientCard"),M=u.findByProps("triggerHaptic"),T=e.stylesheet.createThemedStyleSheet({container:{alignSelf:"flex-start",padding:1,borderRadius:9,width:"100%",marginTop:-4,marginRight:-12},innerContainer:{paddingHorizontal:6,paddingVertical:8,overflow:"hidden",flexDirection:"row",justifyContent:"center",alignItems:"center"},circle:{width:10,height:10,borderRadius:10/2,marginRight:6},fallback:{color:d.semanticColors.BACKGROUND_SECONDARY_ALT},text:{fontFamily:e.constants.Fonts.DISPLAY_NORMAL}});function re({pronoun:t}){const n=ee(),a=te(n.theme,d.semanticColors.TEXT_NORMAL);return e.React.createElement(ae,{title:"Pronouns"},e.React.createElement(Z,{onPress:function(){e.toasts.open({content:t,source:y.Pronoun}),M&&M.triggerHaptic()},style:r.storage.isRole?{justifyContent:"center",alignItems:"center"}:{}},r.storage.isRole?e.React.createElement(ne,{style:T.container,fallbackBackground:T.fallback.color},e.React.createElement(L,{style:T.innerContainer},e.React.createElement(L,{style:[T.circle,{backgroundColor:a}]}),e.React.createElement(U,{style:[T.text,{color:a}]},t))):e.React.createElement(U,{style:[T.text,{fontSize:16,color:a}]},t)))}const{TouchableOpacity:I,View:A,Image:ie,Text:B,Animated:x}=E.General,F=u.findByProps("transitionToGuild","openURL"),k=u.findByStoreName("UserStore"),se=u.findByProps("showUserProfile"),p=e.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...R.shadow()},image:{width:75,height:75,borderRadius:10,...R.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:d.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:d.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function oe({name:t,authors:n}){const a=e.React.useRef(new x.Value(1)).current,i=function(){return x.spring(a,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},o=function(){return x.spring(a,{toValue:1,duration:250,useNativeDriver:!0}).start()},s=function(){return se.showUserProfile({userId:k.getCurrentUser().id})},b={transform:[{scale:a}]};return e.React.createElement(e.React.Fragment,null,e.React.createElement(A,{style:p.container},e.React.createElement(I,{onPress:s,onPressIn:i,onPressOut:o},e.React.createElement(x.View,{style:b},e.React.createElement(ie,{style:[p.image],source:{uri:k?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),e.React.createElement(A,{style:p.textContainer},e.React.createElement(I,{onPress:function(){return F.openURL(S.plugin.source)}},e.React.createElement(B,{style:[p.mainText,p.header]},t)),e.React.createElement(A,{style:{flexDirection:"row"}},e.React.createElement(B,{style:[p.mainText,p.subHeader]},"A project by"),O.mapItem(n,function(g,m,C){return e.React.createElement(I,{onPress:function(){return F.openURL(S.author.profile[g.name]??"https://github.com/")}},e.React.createElement(B,{style:[p.mainText,p.subHeader,{paddingLeft:4,fontFamily:e.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},g.name,m<C.length-1?",":null))})))))}const{View:le,Text:ce}=E.General,V=e.stylesheet.createThemedStyleSheet({text:{color:d.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:12}});function $({label:t,children:n}){return e.React.createElement(le,{style:{marginTop:10}},e.React.createElement(ce,{style:[V.text,V.optionText]},t.toUpperCase()),n)}const{Image:G}=E.General,ue=e.ReactNative.Dimensions?.get("window").width;function Y({style:t,source:n}){const[a,i]=e.React.useState({width:0,height:0}),[o,s]=e.React.useState(0),b=function(){const g=function(v){return typeof v=="string"?parseInt(v.replace("%",""))*ue/100:v},m=g(t.width);if(!t.maxWidth)return m;const C=g(t.maxWidth);return m>C?C:m};return e.React.useEffect(function(){G.getSize(n,function(g,m){i({width:g,height:m})},function(g){console.error(`[${r.manifest.name}] ${g} when fetching ${n}`)}),s(b())},[]),e.React.createElement(G,{style:[...Array.isArray(t)?t:[t],{height:o*(a.height/a.width)}],source:{uri:n},resizeMode:"stretch"})}const{FormRow:f,FormSwitch:H,FormDivider:q}=E.Forms,{ScrollView:de,View:w,Text:he}=E.General,j=u.findByProps("transitionToGuild","openURL"),h=e.stylesheet.createThemedStyleSheet({icon:{color:d.semanticColors.INTERACTIVE_NORMAL},item:{color:d.semanticColors.TEXT_MUTED,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:d.semanticColors.BACKGROUND_MOBILE_SECONDARY,...R.shadow()},subheaderText:{color:d.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}});function fe(){J.useProxy(r.storage);const[t,n]=e.React.useState(r.storage.isTimestamp),[a,i]=e.React.useState(r.storage.isRole);return e.React.createElement(de,null,e.React.createElement(oe,{name:r.manifest.name,authors:r.manifest.authors}),e.React.createElement(w,{style:{marginTop:20}},e.React.createElement($,{label:"Preferences"},e.React.createElement(w,{style:[h.container]},e.React.createElement(f,{label:"Timestamps",subLabel:"Use Timestamps instead of OP Tag for the pronoun in the chat area.",onLongPress:function(){return R.displayToast(`By default, ${r.manifest.name} will use the OP tag to display pronouns. Toggling this option will always use Timestamps instead of OP tag for pronouns.`,"tooltip")},leading:e.React.createElement(f.Icon,{style:h.icon,source:y.Settings.Locale}),trailing:e.React.createElement(H,{value:r.storage.isTimestamp,onValueChange:function(){r.storage.isTimestamp=!r.storage.isTimestamp,n(r.storage.isTimestamp)}})}),e.React.createElement(q,null),e.React.createElement(f,{label:"Roles",subLabel:"Show the pronoun styled as a role instead of plain text inside of profiles.",onLongPress:function(){return R.displayToast(`With this option enabled, ${r.manifest.name} will style pronouns as roles in profiles. Otherwise, it will style them as plain text.`,"tooltip")},leading:e.React.createElement(f.Icon,{style:h.icon,source:y.Settings.Edit}),trailing:e.React.createElement(H,{value:r.storage.isRole,onValueChange:function(){r.storage.isRole=!r.storage.isRole,i(r.storage.isRole)}})}))),e.React.createElement($,{label:"Previews"},e.React.createElement(w,{style:{...h.container,maxWidth:350}},e.React.createElement(Y,{style:h.image,source:`https://cdn.discordapp.com/attachments/${t?"1011346757214543875/1075007230337896448/pronoun-timestamp.png":"1011346757214543875/1075007230107193374/pronoun-tag.png"}`})),e.React.createElement(w,{style:{...h.container,marginTop:10,maxWidth:350}},e.React.createElement(Y,{style:h.image,source:`https://cdn.discordapp.com/attachments/${a?"1011346757214543875/1075007778399199282/profile-role.png":"1011346757214543875/1075007778067841044/profile-plain.png"}`}))),e.React.createElement($,{label:"Source"},e.React.createElement(w,{style:h.container},e.React.createElement(f,{label:"Source",subLabel:`Open the repository of ${r.manifest.name} externally.`,onLongPress:function(){return R.displayToast(`Opens the repository of ${r.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip")},leading:e.React.createElement(f.Icon,{style:h.icon,source:y.Open}),trailing:function(){return e.React.createElement(f.Arrow,null)},onPress:function(){j.openURL(S.plugin.source)}}),e.React.createElement(q,null),e.React.createElement(f,{label:"PronounDB",subLabel:`Open the ${r.manifest.name} website externally at \`https://pronoundb.org\`.`,onLongPress:function(){return R.displayToast("Opens the PronounDB website in an external page which allows you to link your Discord account to PronounDB.","tooltip")},leading:e.React.createElement(f.Icon,{style:h.icon,source:y.Settings.External}),trailing:function(){return e.React.createElement(f.Arrow,null)},onPress:function(){j.openURL(S.plugin.pronoundb)}})))),e.React.createElement(he,{style:h.subheaderText},`Build: (${r.manifest.hash.substring(0,8)})`))}const pe=u.find(function(t){return t?.type?.name=="UserProfile"}),ge=u.findByStoreName("UserStore"),{DCDChatManager:ye}=e.ReactNative.NativeModules,z=e.stylesheet.createThemedStyleSheet({opTagBackgroundColor:{color:d.semanticColors.HEADER_PRIMARY},opTagTextColor:{color:d.semanticColors.BACKGROUND_PRIMARY}});let W,K,Q;var Re={onLoad:function(){W=D.before("getUser",ge,function(t){const n=t[0];c.map[n]||O.insertItem(c.queue,n,c.queue.length,"user id pronoun queue"),c.updateQueuedPronouns()}),K=D.after("type",pe,function(t,n){const a=X.findInReactTree(n,function(s){return s?.type?.displayName==="View"&&s?.props?.children.findIndex(function(b){return b?.type?.name==="UserProfileBio"})!==-1})?.props?.children;if(!a)return n;const{userId:i}=a?.find(function(s){return typeof s?.props?.displayProfile?.userId=="string"})?.props?.displayProfile??{};if(!i||!c.map[i]||c.referenceMap[c.map[i]]==="unspecified")return n;const o=c.referenceMap[c.map[i]];a.unshift(React.createElement(re,{pronoun:o}))}),Q=D.before("updateRows",ye,function(t){const n=JSON.parse(t[1]);for(const a of n){if(a.type!==1||!a?.message?.authorId||!c.map[a?.message?.authorId]||c.referenceMap[c.map[a?.message?.authorId]]==="unspecified")continue;const i=c.referenceMap[c.map[a.message.authorId]];if(r.storage.isTimestamp&&a.message.timestamp){a.message.timestamp+=" \u2022 "+i;continue}a.message.opTagText&&(a.message.tagText=a.message.tagText?a.message.tagText+" \u2022 ":""+a.message.opTagText),a.message.opTagText=i,a.message.opTagTextColor=e.ReactNative.processColor(z.opTagTextColor.color),a.message.opTagBackgroundColor=e.ReactNative.processColor(z.opTagBackgroundColor.color)}t[1]=JSON.stringify(n)})},onUnload:function(){W?.(),K?.(),Q?.()},settings:fe};return P.default=Re,Object.defineProperty(P,"__esModule",{value:!0}),P})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.storage);
