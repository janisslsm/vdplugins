(function(D,u,e,I,i,J,l,T,d,Z){"use strict";var y={Failed:l.getAssetIDByName("Small"),Delete:l.getAssetIDByName("ic_message_delete"),Copy:l.getAssetIDByName("toast_copy_link"),Open:l.getAssetIDByName("ic_leave_stage"),Clipboard:l.getAssetIDByName("pending-alert"),Clock:l.getAssetIDByName("clock"),Pronoun:l.getAssetIDByName("ic_accessibility_24px"),Settings:{Toasts:{Settings:l.getAssetIDByName("ic_selection_checked_24px"),Failed:l.getAssetIDByName("ic_close_circle_24px")},Initial:l.getAssetIDByName("coffee"),Update:l.getAssetIDByName("discover"),Locale:l.getAssetIDByName("ic_locale_24px"),External:l.getAssetIDByName("ic_raised_hand_list"),Edit:l.getAssetIDByName("ic_edit_24px")}},R={shadow:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return{shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:t,shadowRadius:4.65,elevation:8}},displayToast:function(t,n){e.toasts.open({content:n=="clipboard"?`Copied ${t} to clipboard.`:t,source:n=="clipboard"?y.Clipboard:y.Settings.Initial})}};function N(t,n,a,r,o){try{return t(...n)}catch(s){console.warn(`[${a}] The following error happened when trying to ${r} ${o??"unspecificied label"}: ${s}`);return}}const O=function(t,n,a,r){return N(function(){if(t){t.length++,a++;for(let o=t.length-1;o>=a;o--)t[o]=t[o-1];return t[a-1]=n,t.length}},[t,n,a],i.manifest.name,"insert an item at",r)};var L={mapItem:function(t,n,a){return N(function(){let r=[];for(let o=0;o<t.length;o++)O(r,n(t[o],o,t),r.length);return r},[t,n],i.manifest.name,"map an array at",a)},insertItem:O},c={map:{},queue:[],fetching:!1,referenceMap:{hh:"he/him",hi:"he/it",hs:"he/she",ht:"he/they",ih:"it/him",ii:"it/its",is:"it/she",it:"it/they",shh:"she/he",sh:"she/her",si:"she/it",st:"she/they",th:"they/he",ti:"they/it",ts:"they/she",tt:"they/them",any:"any",other:"other",ask:"ask",avoid:"avoid, use name",unspecified:"unspecified"},async updateQueuedPronouns(){var t=this;if(this.queue.length<=0||this.fetching)return;const n=this.queue.splice(0,49),a=function(s){return t.queue.length<=0?s:t.map[s]?a(t.queue.shift()):s};for(const s of n)this.map[s]&&(n[s]=a(s));this.fetching=!0;const r=await(await fetch(`https://pronoundb.org/api/v1/lookup-bulk?platform=discord&ids=${n.join(",")}`,{method:"GET",headers:{Accept:"application/json","X-PronounDB-Source":"Vendetta"}})).json(),o=Object.fromEntries(Object.entries(r).filter(function(s){let[m,C]=s;return!isNaN(+m)}));Object.assign(this.map,o),this.fetching=!1,this.queue.length>0&&this.updateQueuedPronouns()}},S={plugin:{source:"https://github.com/acquitelol/vd-pronoun-db",pronoundb:"https://pronoundb.org/"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};const{View:U,Text:M,TouchableOpacity:ee}=T.General,{useThemeContext:te}=u.findByProps("useThemeContext"),ae=u.find(function(t){return t.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??u.find(function(t){return t.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},ne=u.findByName("UserProfileSection"),{UserProfileGradientCard:re}=u.findByProps("UserProfileGradientCard"),F=u.findByProps("triggerHaptic"),b=e.stylesheet.createThemedStyleSheet({container:{alignSelf:"flex-start",padding:1,borderRadius:9,width:"100%",marginTop:-4,marginRight:-12},innerContainer:{paddingHorizontal:6,paddingVertical:8,overflow:"hidden",flexDirection:"row",justifyContent:"center",alignItems:"center"},circle:{width:10,height:10,borderRadius:10/2,marginRight:6},fallback:{color:d.semanticColors.BACKGROUND_SECONDARY_ALT},text:{fontFamily:e.constants.Fonts.DISPLAY_NORMAL}});function ie(t){let{pronoun:n}=t;const a=te(),r=ae(a.theme,d.semanticColors.TEXT_NORMAL);return e.React.createElement(ne,{title:"Pronouns"},e.React.createElement(ee,{onPress:function(){e.toasts.open({content:n,source:y.Pronoun}),F&&F.triggerHaptic()},style:i.storage.isRole?{justifyContent:"center",alignItems:"center"}:{}},i.storage.isRole?e.React.createElement(re,{style:b.container,fallbackBackground:b.fallback.color},e.React.createElement(U,{style:b.innerContainer},e.React.createElement(U,{style:[b.circle,{backgroundColor:r}]}),e.React.createElement(M,{style:[b.text,{color:r}]},n))):e.React.createElement(M,{style:[b.text,{fontSize:16,color:r}]},n)))}const{TouchableOpacity:A,View:v,Image:se,Text:B,Animated:x}=T.General,k=u.findByProps("transitionToGuild","openURL"),V=u.findByStoreName("UserStore"),oe=u.findByProps("showUserProfile"),f=e.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...R.shadow()},image:{width:75,height:75,borderRadius:10,...R.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:d.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:d.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function le(t){let{name:n,authors:a}=t;const r=e.React.useRef(new x.Value(1)).current,o=function(){return x.spring(r,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},s=function(){return x.spring(r,{toValue:1,duration:250,useNativeDriver:!0}).start()},m=function(){return oe.showUserProfile({userId:V.getCurrentUser().id})},C={transform:[{scale:r}]};return e.React.createElement(e.React.Fragment,null,e.React.createElement(v,{style:f.container},e.React.createElement(A,{onPress:m,onPressIn:o,onPressOut:s},e.React.createElement(x.View,{style:C},e.React.createElement(se,{style:[f.image],source:{uri:V?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),e.React.createElement(v,{style:f.textContainer},e.React.createElement(A,{onPress:function(){return k.openURL(S.plugin.source)}},e.React.createElement(B,{style:[f.mainText,f.header]},n)),e.React.createElement(v,{style:{flexDirection:"row"}},e.React.createElement(B,{style:[f.mainText,f.subHeader]},"A project by"),L.mapItem(a,function(g,E,P){return e.React.createElement(A,{onPress:function(){return k.openURL(S.author.profile[g.name]??"https://github.com/")}},e.React.createElement(B,{style:[f.mainText,f.subHeader,{paddingLeft:4,fontFamily:e.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},g.name,E<P.length-1?",":null))})))))}const{View:ce,Text:ue}=T.General,G=e.stylesheet.createThemedStyleSheet({text:{color:d.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:12}});function $(t){let{label:n,children:a}=t;return e.React.createElement(ce,{style:{marginTop:10}},e.React.createElement(ue,{style:[G.text,G.optionText]},n.toUpperCase()),a)}const{Image:Y}=T.General,de=e.ReactNative.Dimensions?.get("window").width;function H(t){let{style:n,source:a}=t;const[r,o]=e.React.useState({width:0,height:0}),[s,m]=e.React.useState(0),C=function(){const g=function(_){return typeof _=="string"?parseInt(_.replace("%",""))*de/100:_},E=g(n.width);if(!n.maxWidth)return E;const P=g(n.maxWidth);return E>P?P:E};return e.React.useEffect(function(){Y.getSize(a,function(g,E){o({width:g,height:E})},function(g){console.error(`[${i.manifest.name}] ${g} when fetching ${a}`)}),m(C())},[]),e.React.createElement(Y,{style:[...Array.isArray(n)?n:[n],{height:s*(r.height/r.width)}],source:{uri:a},resizeMode:"stretch"})}const{FormRow:p,FormSwitch:q,FormDivider:j}=T.Forms,{ScrollView:he,View:w,Text:pe}=T.General,z=u.findByProps("transitionToGuild","openURL"),h=e.stylesheet.createThemedStyleSheet({icon:{color:d.semanticColors.INTERACTIVE_NORMAL},item:{color:d.semanticColors.TEXT_MUTED,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:d.semanticColors.BACKGROUND_MOBILE_SECONDARY,...R.shadow()},subheaderText:{color:d.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}});function fe(){Z.useProxy(i.storage);const[t,n]=e.React.useState(i.storage.isTimestamp),[a,r]=e.React.useState(i.storage.isRole);return e.React.createElement(he,null,e.React.createElement(le,{name:i.manifest.name,authors:i.manifest.authors}),e.React.createElement(w,{style:{marginTop:20}},e.React.createElement($,{label:"Preferences"},e.React.createElement(w,{style:[h.container]},e.React.createElement(p,{label:"Timestamps",subLabel:"Use Timestamps instead of OP Tag for the pronoun in the chat area.",onLongPress:function(){return R.displayToast(`By default, ${i.manifest.name} will use the OP tag to display pronouns. Toggling this option will always use Timestamps instead of OP tag for pronouns.`,"tooltip")},leading:e.React.createElement(p.Icon,{style:h.icon,source:y.Settings.Locale}),trailing:e.React.createElement(q,{value:i.storage.isTimestamp,onValueChange:function(){i.storage.isTimestamp=!i.storage.isTimestamp,n(i.storage.isTimestamp)}})}),e.React.createElement(j,null),e.React.createElement(p,{label:"Roles",subLabel:"Show the pronoun styled as a role instead of plain text inside of profiles.",onLongPress:function(){return R.displayToast(`With this option enabled, ${i.manifest.name} will style pronouns as roles in profiles. Otherwise, it will style them as plain text.`,"tooltip")},leading:e.React.createElement(p.Icon,{style:h.icon,source:y.Settings.Edit}),trailing:e.React.createElement(q,{value:i.storage.isRole,onValueChange:function(){i.storage.isRole=!i.storage.isRole,r(i.storage.isRole)}})}))),e.React.createElement($,{label:"Previews"},e.React.createElement(w,{style:{...h.container,maxWidth:350}},e.React.createElement(H,{style:h.image,source:`https://cdn.discordapp.com/attachments/${t?"1011346757214543875/1075007230337896448/pronoun-timestamp.png":"1011346757214543875/1075007230107193374/pronoun-tag.png"}`})),e.React.createElement(w,{style:{...h.container,marginTop:10,maxWidth:350}},e.React.createElement(H,{style:h.image,source:`https://cdn.discordapp.com/attachments/${a?"1011346757214543875/1075007778399199282/profile-role.png":"1011346757214543875/1075007778067841044/profile-plain.png"}`}))),e.React.createElement($,{label:"Source"},e.React.createElement(w,{style:h.container},e.React.createElement(p,{label:"Source",subLabel:`Open the repository of ${i.manifest.name} externally.`,onLongPress:function(){return R.displayToast(`Opens the repository of ${i.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip")},leading:e.React.createElement(p.Icon,{style:h.icon,source:y.Open}),trailing:function(){return e.React.createElement(p.Arrow,null)},onPress:function(){z.openURL(S.plugin.source)}}),e.React.createElement(j,null),e.React.createElement(p,{label:"PronounDB",subLabel:`Open the ${i.manifest.name} website externally at \`https://pronoundb.org\`.`,onLongPress:function(){return R.displayToast("Opens the PronounDB website in an external page which allows you to link your Discord account to PronounDB.","tooltip")},leading:e.React.createElement(p.Icon,{style:h.icon,source:y.Settings.External}),trailing:function(){return e.React.createElement(p.Arrow,null)},onPress:function(){z.openURL(S.plugin.pronoundb)}})))),e.React.createElement(pe,{style:h.subheaderText},`Build: (${i.manifest.hash.substring(0,8)})`))}const ge=u.find(function(t){return t?.type?.name=="UserProfile"}),ye=u.findByStoreName("UserStore"),{DCDChatManager:Re}=e.ReactNative.NativeModules,W=e.stylesheet.createThemedStyleSheet({opTagBackgroundColor:{color:d.semanticColors.HEADER_PRIMARY},opTagTextColor:{color:d.semanticColors.BACKGROUND_PRIMARY}});let K,Q,X;var me={onLoad:function(){K=I.before("getUser",ye,function(t){const n=t[0];c.map[n]||L.insertItem(c.queue,n,c.queue.length,"user id pronoun queue"),c.updateQueuedPronouns()}),Q=I.after("type",ge,function(t,n){const a=J.findInReactTree(n,function(s){return s?.type?.displayName==="View"&&s?.props?.children.findIndex(function(m){return m?.type?.name==="UserProfileBio"})!==-1})?.props?.children;if(!a)return n;const{userId:r}=a?.find(function(s){return typeof s?.props?.displayProfile?.userId=="string"})?.props?.displayProfile??{};if(!r||!c.map[r]||c.referenceMap[c.map[r]]==="unspecified")return n;const o=c.referenceMap[c.map[r]];a.unshift(React.createElement(ie,{pronoun:o}))}),X=I.before("updateRows",Re,function(t){const n=JSON.parse(t[1]);for(const a of n){if(a.type!==1||!a?.message?.authorId||!c.map[a?.message?.authorId]||c.referenceMap[c.map[a?.message?.authorId]]==="unspecified")continue;const r=c.referenceMap[c.map[a.message.authorId]];if(i.storage.isTimestamp&&a.message.timestamp){a.message.timestamp+=" \u2022 "+r;continue}a.message.opTagText&&(a.message.tagText=a.message.tagText?a.message.tagText+" \u2022 ":""+a.message.opTagText),a.message.opTagText=r,a.message.opTagTextColor=e.ReactNative.processColor(W.opTagTextColor.color),a.message.opTagBackgroundColor=e.ReactNative.processColor(W.opTagBackgroundColor.color)}t[1]=JSON.stringify(n)})},onUnload:function(){K?.(),Q?.(),X?.()},settings:fe};return D.default=me,Object.defineProperty(D,"__esModule",{value:!0}),D})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.storage);
