(function(w,r,o,E,t,S,b,R,C,m,l,I,V){"use strict";const N="915703782174752809",v="https://manti.vendicated.dev",d=v+"/api/reviewdb";var J=Object.freeze({__proto__:null,API_URL:d,BASE_URL:v,CLIENT_ID:N});const{getCurrentUser:A}=o.findByStoreName("UserStore"),X=o.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??o.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},{useThemeContext:Y}=o.findByProps("useThemeContext"),P=function(e){return e.sender.discordID===A()?.id||T.includes(A()?.id)};async function u(e,n){const a=await(await fetch(e,{headers:{"content-type":"application/json",accept:"application/json"},...n})).json();if(a.success===!1)throw new Error(a.message);return a}const h=function(e){return X(Y()?.theme??"dark",E.semanticColors[e])};var H=Object.freeze({__proto__:null,canDeleteReview:P,jsonFetch:u,useThemedColor:h});const D=async function(e){return(await u(d+`/users/${e}/reviews`)).reviews},B=async function(){return await u(v+"/admins")},_=async function(e,n){return await u(d+`/users/${e}/reviews`,{method:"PUT",body:JSON.stringify({comment:n,token:r.storage.authToken})})},x=async function(e,n){return await u(d+`/users/${e}/reviews`,{method:"DELETE",body:JSON.stringify({reviewid:n,token:r.storage.authToken})})},U=async function(e){return await u(d+"/reports",{method:"PUT",body:JSON.stringify({reviewid:e,token:r.storage.authToken})})};var G=Object.freeze({__proto__:null,addReview:_,deleteReview:x,getAdmins:B,getCurrentUser:async function(){return await u(d+"/users",{method:"POST",body:JSON.stringify({token:r.storage.authToken})})},getReviews:D,reportReview:U});const{hideActionSheet:W}=o.findByProps("openLazy","hideActionSheet"),{showSimpleActionSheet:q}=o.findByProps("showSimpleActionSheet");function k(e){return q({key:"ReviewOverflow",header:{title:e.type!==3?`Review by ${e.sender.username}`:"ReviewDB System Message",onClose:function(){return W()}},options:[{label:"Copy Text",onPress:function(){t.clipboard.setString(e.comment),m.showToast("Copied Review Text",l.getAssetIDByName("ic_message_copy"))}},...r.storage.authToken&&e.type!==3?[...P(e)?[{label:"Delete Review",isDestructive:!0,onPress:function(){return C.showConfirmationAlert({title:"Delete Review",content:"Are you sure you want to delete this review?",confirmText:"Yes",cancelText:"No",confirmColor:"red",onConfirm:function(){return x(e.sender.discordID,e.id)}})}}]:[],{label:"Report Review",isDestructive:!0,onPress:function(){return C.showConfirmationAlert({title:"Report Review",content:"Are you sure you want to report this review?",confirmText:"Yes",cancelText:"No",confirmColor:"red",onConfirm:function(){return U(e.id)}})}}]:[]]})}function K({badge:e}){return React.createElement(t.ReactNative.Pressable,{style:{marginLeft:4},onPress:function(){m.showToast(e.name,{uri:e.icon})}},React.createElement(t.ReactNative.Image,{source:{uri:e.icon,width:16,height:16}}))}const $=t.stylesheet.createThemedStyleSheet({row:{flexDirection:"row",alignItems:"center"}}),{FormLabel:Q}=R.Forms;function Z({username:e,badges:n}){return React.createElement(t.ReactNative.View,{style:$.row},React.createElement(Q,{text:e,style:{color:h("TEXT_NORMAL")}}),React.createElement(t.ReactNative.View,{style:$.row},n.map(function(a){return React.createElement(K,{badge:a})})))}const ee=t.stylesheet.createThemedStyleSheet({avatar:{height:36,width:36,borderRadius:18}}),{FormRow:te,FormSubLabel:ne}=R.Forms;function re({review:e}){return React.createElement(te,{label:React.createElement(Z,{username:e.sender.username,badges:e.sender.badges}),subLabel:React.createElement(ne,{text:e.comment,style:{color:h("TEXT_NORMAL")}}),leading:React.createElement(t.ReactNative.Image,{style:ee.avatar,source:{uri:e.sender.profilePhoto}}),onLongPress:function(){return k(e)}})}const p=t.stylesheet.createThemedStyleSheet({container:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:8,paddingVertical:4},textInput:{flex:1,flexGrow:1,fontSize:16,fontFamily:t.constants.Fonts.DISPLAY_MEDIUM},sendButton:{flexShrink:1,flexDirection:"row",alignItems:"center",justifyContent:"center",minHeight:40,minWidth:40,borderRadius:999}}),{useThemeContext:ae}=o.findByProps("useThemeContext");function oe({userId:e,shouldEdit:n,refetch:a}){I.useProxy(r.storage);const[s,c]=t.React.useState(""),i=!r.storage.authToken,j=!r.storage.authToken||s.length===0;return t.React.createElement(t.ReactNative.View,{style:p.container},t.React.createElement(t.ReactNative.TextInput,{style:{...p.textInput,color:h("TEXT_NORMAL")},editable:!i,placeholder:i?"You must be authenticated to add a review.":`Tap to ${n?"edit your":"add a"} review`,placeholderTextColor:h("INPUT_PLACEHOLDER_TEXT"),value:s,onChangeText:function(y){return c(y)}}),t.React.createElement(t.ReactNative.Pressable,{style:{...p.sendButton,backgroundColor:r.storage.useThemedSend&&ae().primaryColor||E.rawColors.BRAND_500,opacity:j?.25:1},disabled:j,onPress:function(){_(e,s).then(function(y){c(""),a(),m.showToast(y.message,l.getAssetIDByName("Check"))}).catch(function(y){return m.showToast(y.message,l.getAssetIDByName("Small"))})}},t.React.createElement(t.ReactNative.Image,{style:{tintColor:"#fff"},source:l.getAssetIDByName("ic_send")})))}const{getCurrentUser:ie}=o.findByStoreName("UserStore"),se=o.findByName("UserProfileSection");function L({userId:e}){const[n,a]=t.React.useState([]),s=function(){D(e).then(function(i){return a(i)})};t.React.useEffect(s,[]);const c=n.filter(function(i){return i.sender.discordID===ie()?.id}).length!==0;return t.React.createElement(R.ErrorBoundary,null,t.React.createElement(se,{title:"Reviews",showContainer:!0},t.React.createElement(t.ReactNative.View,{style:{flex:1}},n.map(function(i){return t.React.createElement(re,{review:i})})),t.React.createElement(oe,{userId:e,refetch:s,shouldEdit:c})))}let g=o.findByTypeName("UserProfile");g===void 0&&(g=o.findByTypeName("UserProfileContent"));function ce(){return S.after("type",g,function(e,n){const a=b.findInReactTree(n,function(c){return c?.type?.displayName==="View"&&c?.props?.children.findIndex(function(i){return i?.type?.name==="UserProfileBio"||i?.type?.name==="UserProfileAboutMeCard"})!==-1})?.props?.children,s=e[0]?.userId;a?.push(t.React.createElement(L,{userId:s}))})}const{pushModal:ue,popModal:M}=o.findByProps("pushModal"),le=o.findByName("OAuth2AuthorizeModal");function F(){return ue({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:le,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:N,redirectUri:d+"/auth",scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function({location:e}){try{const n=new URL(e);n.searchParams.append("returnType","json"),n.searchParams.append("clientMod","vendetta");const{token:a,success:s,message:c}=await u(n,{headers:{accept:"application/json"}});if(s)r.storage.authToken=a;else throw M("oauth2-authorize"),new Error(c)}catch(n){V.logger.error("Authorization failed!",n)}},dismissOAuthModal:function(){return M("oauth2-authorize")}},closable:!0}})}function de(){return globalThis.vendettaRDB={api:G,utils:{...H,showAuthModal:F,showReviewActionSheet:k},constants:J},function(){return delete globalThis.vendettaRDB}}const O=o.findByTypeName("SimplifiedUserProfileContent");function fe(){return O!==void 0?S.after("type",O,function(e,n){const a=b.findInReactTree(n,function(c){return c?.type?.displayName==="View"&&c?.props?.children.findIndex(function(i){return i?.type?.name==="SimplifiedUserProfileAboutMeCard"})!==-1})?.props?.children,s=e[0]?.user?.id;a?.push(t.React.createElement(L,{userId:s}))}):function(){}}const{FormSection:z,FormRow:f,FormSwitchRow:he,FormDivider:ye}=R.Forms;function we(){return I.useProxy(r.storage),React.createElement(t.ReactNative.ScrollView,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(z,{title:"Authentication",titleStyleType:"no_border"},React.createElement(f,{label:"Authenticate with ReviewDB",leading:React.createElement(f.Icon,{source:l.getAssetIDByName("copy")}),trailing:f.Arrow,onPress:F}),React.createElement(ye,null),React.createElement(f,{label:"Log out of ReviewDB",subLabel:"Note that this does not remove ReviewDB from your Authorized Apps page in Discord.",leading:React.createElement(f.Icon,{source:l.getAssetIDByName("ic_logout_24px")}),disabled:r.storage.authToken.length===0,onPress:function(){return r.storage.authToken=""}})),React.createElement(z,{title:"Settings"},React.createElement(he,{label:"Use profile-themed send button",subLabel:"Controls whether the review send button should attempt to match the user's profile colors.",leading:React.createElement(f.Icon,{source:l.getAssetIDByName("ic_paint_brush")}),value:r.storage.useThemedSend,onValueChange:function(e){return r.storage.useThemedSend=e}})))}r.storage.authToken??="",r.storage.useThemedSend??=!0;const Re=[de(),ce(),fe()],T=[];B().then(function(e){return T.push(...e)});const me=function(){return Re.forEach(function(e){return e()})};return w.admins=T,w.onUnload=me,w.settings=we,w})({},vendetta.plugin,vendetta.metro,vendetta.ui,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.components,vendetta.ui.alerts,vendetta.ui.toasts,vendetta.ui.assets,vendetta.storage,vendetta);
