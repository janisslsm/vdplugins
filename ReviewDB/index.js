(function(g,o,r,d,t,T,b,E,I,f,u,N,W){"use strict";const D="915703782174752809",S="https://manti.vendicated.dev",y=S+"/api/reviewdb";var q=Object.freeze({__proto__:null,API_URL:y,BASE_URL:S,CLIENT_ID:D});const{getCurrentUser:_}=r.findByStoreName("UserStore"),K=r.find(function(e){return e.default?.internal?.resolveSemanticColor})?.default.internal.resolveSemanticColor??r.find(function(e){return e.meta?.resolveSemanticColor})?.meta.resolveSemanticColor??function(){},{useThemeContext:Q}=r.findByProps("useThemeContext"),$=function(e){return e.sender.discordID===_()?.id||B.includes(_()?.id)};async function h(e,n){const a=await(await fetch(e,{headers:{"content-type":"application/json",accept:"application/json"},...n})).json();if(a.success===!1)throw new Error(a.message);return a}const x={TEXT_NORMAL:"TEXT_DEFAULT"},p=function(e){return!d.semanticColors[e]&&x[e]&&(e=x[e]),d.semanticColors[e]&&K(Q()?.theme??"dark",d.semanticColors[e])||"#000000"};var Z=Object.freeze({__proto__:null,canDeleteReview:$,jsonFetch:h,useThemedColor:p});const k=async function(e){return(await h(y+`/users/${e}/reviews`)).reviews},L=async function(){return await h(S+"/admins")},A=async function(e,n){return await h(y+`/users/${e}/reviews`,{method:"PUT",body:JSON.stringify({comment:n,token:o.storage.authToken})})},U=async function(e,n){return await h(y+`/users/${e}/reviews`,{method:"DELETE",body:JSON.stringify({reviewid:n,token:o.storage.authToken})})},M=async function(e){return await h(y+"/reports",{method:"PUT",body:JSON.stringify({reviewid:e,token:o.storage.authToken})})};var ee=Object.freeze({__proto__:null,addReview:A,deleteReview:U,getAdmins:L,getCurrentUser:async function(){return await h(y+"/users",{method:"POST",body:JSON.stringify({token:o.storage.authToken})})},getReviews:k,reportReview:M});const{hideActionSheet:te}=r.findByProps("openLazy","hideActionSheet"),{showSimpleActionSheet:ne}=r.findByProps("showSimpleActionSheet");function z(e){return ne({key:"ReviewOverflow",header:{title:e.type!==3?`Review by ${e.sender.username}`:"ReviewDB System Message",onClose:function(){return te()}},options:[{label:"Copy Text",onPress:function(){t.clipboard.setString(e.comment),f.showToast("Copied Review Text",u.getAssetIDByName("ic_message_copy"))}},...o.storage.authToken&&e.type!==3?[...$(e)?[{label:"Delete Review",isDestructive:!0,onPress:function(){return I.showConfirmationAlert({title:"Delete Review",content:"Are you sure you want to delete this review?",confirmText:"Yes",cancelText:"No",confirmColor:"red",onConfirm:function(){return U(e.sender.discordID,e.id)}})}}]:[],{label:"Report Review",isDestructive:!0,onPress:function(){return I.showConfirmationAlert({title:"Report Review",content:"Are you sure you want to report this review?",confirmText:"Yes",cancelText:"No",confirmColor:"red",onConfirm:function(){return M(e.id)}})}}]:[]]})}function re({badge:e}){return React.createElement(t.ReactNative.Pressable,{style:{marginLeft:4},onPress:function(){f.showToast(e.name,{uri:e.icon})}},React.createElement(t.ReactNative.Image,{source:{uri:e.icon,width:16,height:16}}))}const O=t.stylesheet.createThemedStyleSheet({row:{flexDirection:"row",alignItems:"center"}}),{FormLabel:ae}=E.Forms;function ie({username:e,badges:n}){return React.createElement(t.ReactNative.View,{style:O.row},React.createElement(ae,{text:e,style:{color:p("TEXT_NORMAL")}}),React.createElement(t.ReactNative.View,{style:O.row},n.map(function(a){return React.createElement(re,{badge:a})})))}const oe=t.stylesheet.createThemedStyleSheet({avatar:{height:36,width:36,borderRadius:18},card:{backgroundColor:d.semanticColors.CARD_SECONDARY_BG}}),{FormRow:se,FormSubLabel:ce}=E.Forms,{TableRowGroup:le}=r.findByProps("TableRow");function ue({review:e,style:n}){return React.createElement(le,{style:[n]},React.createElement(se,{style:[n],label:React.createElement(ie,{username:e.sender.username,badges:e.sender.badges}),subLabel:React.createElement(ce,{text:e.comment,style:{color:p("TEXT_NORMAL")}}),leading:React.createElement(t.ReactNative.Image,{style:oe.avatar,source:{uri:e.sender.profilePhoto}}),onLongPress:function(){return z(e)}}))}const de=function(e,n){return function(){const a=function(){f.showToast(`${e} not found! Search for PNF in Debug Logs!`),console.warn(`!! PNF ERROR !!
Missing the redesign ${n?"function":"component"}: ${e}. Please bug @nexpid about this on Discord!`)};return n?a():t.React.useEffect(a,[]),null}},fe=function(...e){return r.findByProps(...e)?.[e[0]]},F=function(e,...n){return fe(...n)??de(n[0],e)},V=F(!1,"TextInput"),he=F(!1,"Button"),w=t.stylesheet.createThemedStyleSheet({container:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:8,paddingVertical:4},container_redesign:{backgroundColor:d.semanticColors.CARD_PRIMARY_BG,flex:1,justifyContent:"center",paddingHorizontal:8,paddingVertical:4},textInput:{flex:1,flexGrow:1,fontSize:16,fontFamily:t.constants.Fonts.DISPLAY_MEDIUM},sendButton:{flexShrink:1,flexDirection:"row",alignItems:"center",justifyContent:"center",minHeight:40,minWidth:40,borderRadius:999}}),{useThemeContext:j}=r.findByProps("useThemeContext");function Re({userId:e,shouldEdit:n,refetch:a}){N.useProxy(o.storage);const[s,c]=t.React.useState(""),l=!o.storage.authToken,R=!o.storage.authToken||s.length===0;return V?t.React.createElement(t.ReactNative.View,null,t.React.createElement(V,{style:{...w.textInput,color:p("TEXT_NORMAL")},isDisabled:l,placeholder:l?"You must be authenticated to add a review.":`Tap to ${n?"edit your":"add a"} review`,placeholderTextColor:p("INPUT_PLACEHOLDER_TEXT"),value:s,onChange:function(i){return c(i)}}),t.React.createElement(he,{size:"sm",style:{...w.sendButton,backgroundColor:o.storage.useThemedSend&&j().primaryColor||d.rawColors.BRAND_500,opacity:R?.25:1},text:"",icon:t.React.createElement(t.ReactNative.Image,{style:{tintColor:"#fff"},source:u.getAssetIDByName("ic_send")}),disabled:R,onPress:function(){A(e,s).then(function(i){c(""),a(),f.showToast(i.message,u.getAssetIDByName("Check"))}).catch(function(i){return f.showToast(i.message,u.getAssetIDByName("Small"))})}})):t.React.createElement(t.ReactNative.View,{style:w.container},t.React.createElement(t.ReactNative.TextInput,{style:{...w.textInput,color:p("TEXT_NORMAL")},editable:l,placeholder:l?"You must be authenticated to add a review.":`Tap to ${n?"edit your":"add a"} review`,placeholderTextColor:p("INPUT_PLACEHOLDER_TEXT"),value:s,onChangeText:function(i){return c(i)}}),t.React.createElement(t.ReactNative.Pressable,{style:{...w.sendButton,backgroundColor:o.storage.useThemedSend&&j().primaryColor||d.rawColors.BRAND_500,opacity:R?.25:1},disabled:R,onPress:function(){A(e,s).then(function(i){c(""),a(),f.showToast(i.message,u.getAssetIDByName("Check"))}).catch(function(i){return f.showToast(i.message,u.getAssetIDByName("Small"))})}},t.React.createElement(t.ReactNative.Image,{style:{tintColor:"#fff"},source:u.getAssetIDByName("ic_send")})))}const{getCurrentUser:ye}=r.findByStoreName("UserStore"),pe=r.findByName("UserProfileCard");r.findByProps("TableRow");const{FlashList:we}=r.findByProps("FlashList"),{getDisplayProfile:ve}=r.findByProps("getDisplayProfile");function P({userId:e}){const[n,a]=t.React.useState([]),s=function(){k(e).then(function(i){return a(i)})};t.React.useEffect(s,[]);const c=n.filter(function(i){return i.sender.discordID===ye()?.id}).length!==0,l=ve?.(e)?.themeColors;console.log(l);const R=t.stylesheet.createThemedStyleSheet({avatar:{height:36,width:36,borderRadius:18},card:{backgroundColor:l===void 0?d.semanticColors.CARD_PRIMARY_BG:"#00000073",borderRadius:16,padding:8},reviewCard:{backgroundColor:l===void 0?d.semanticColors.CARD_SECONDARY_BG:"#00000083"}});return t.React.createElement(E.ErrorBoundary,null,t.React.createElement(t.ReactNative.View,{style:[R.card]},t.React.createElement(pe,{title:"Reviews",styles:[R.card]},t.React.createElement(we,{ItemSeparatorComponent:function(){return t.React.createElement(t.ReactNative.View,{style:{height:8}})},data:n,renderItem:function({item:i}){return t.React.createElement(ue,{style:R.reviewCard,review:i})},keyExtractor:function(i){return i.sender.username},scrollEnabled:!1,estimatedSize:84}),t.React.createElement(Re,{userId:e,refetch:s,shouldEdit:c}))))}let m=r.findByTypeName("UserProfile");m===void 0&&(m=r.findByTypeName("UserProfileContent"));function ge(){return T.after("type",m,function(e,n){const a=b.findInReactTree(n,function(c){return c?.type?.displayName==="View"&&c?.props?.children.findIndex(function(l){return l?.type?.name==="UserProfileBio"||l?.type?.name==="UserProfileAboutMeCard"})!==-1})?.props?.children;let s=e[0]?.userId;s===void 0&&(s=e[0]?.user?.id),a?.push(t.React.createElement(P,{userId:s}))})}const{pushModal:Te,popModal:G}=r.findByProps("pushModal"),Ee=r.findByName("OAuth2AuthorizeModal");function Y(){return Te({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Ee,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:D,redirectUri:y+"/auth",scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function({location:e}){try{const n=new URL(e);n.searchParams.append("returnType","json"),n.searchParams.append("clientMod","vendetta");const{token:a,success:s,message:c}=await h(n,{headers:{accept:"application/json"}});if(s)o.storage.authToken=a;else throw G("oauth2-authorize"),new Error(c)}catch(n){f.showToast("Authorization failed! Try again later.",u.getAssetIDByName("CircleErrorIcon")),W.logger.error("Authorization failed!",n)}},dismissOAuthModal:function(){return G("oauth2-authorize")}},closable:!0}})}function Ce(){return globalThis.vendettaRDB={api:ee,utils:{...Z,showAuthModal:Y,showReviewActionSheet:z},constants:q},function(){return delete globalThis.vendettaRDB}}const H=r.findByTypeName("SimplifiedUserProfileContent");function be(){return H!==void 0?T.after("type",H,function(e,n){const a=b.findInReactTree(n,function(c){return c?.type?.displayName==="View"&&c?.props?.children.findIndex(function(l){return l?.type?.name==="SimplifiedUserProfileAboutMeCard"})!==-1})?.props?.children,s=e[0]?.user?.id;a?.push(t.React.createElement(P,{userId:s}))}):function(){}}const Se=r.findByProps("ActionSheet")?.ActionSheet??r.find(function(e){return e.render?.name==="ActionSheet"}),{ActionSheetTitleHeader:Ae,ActionSheetCloseButton:Pe}=r.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton"),me=r.findByProps("openLazy","hideActionSheet"),{openLazy:Be,hideActionSheet:Ie}=me;r.findByProps("showSimpleActionSheet");const C=function(e){return React.createElement(Se,null,React.createElement(Ae,{title:e.title,trailing:React.createElement(Pe,{onPress:e.onClose??function(){Ie()}})}),React.createElement(t.ReactNative.View,b.without(e,"title","onClose")))};C.open=function(e,n){Be(new Promise(function(a){a({default:e})}),"ActionSheet",n)};function X({userId:e}){return t.React.createElement(C,{title:"Reviews"},t.React.createElement(t.ReactNative.ScrollView,{style:{gap:12,marginBottom:12}},t.React.createElement(P,{userId:e})))}const{TableRow:Ne,TableRowGroup:De}=r.findByProps("TableRow");function _e({userId:e}){return t.React.createElement(E.ErrorBoundary,null,t.React.createElement(De,null,t.React.createElement(Ne,{label:"Reviews",onPress:function(){C.open(X,{userId:e})}})))}let $e=r.findByName("GuildActionSheetProgress",!1);function xe(){return T.instead("default",$e,function(e,n){const a=e[0]?.guild?.id;return t.React.createElement(_e,{userId:a})})}let ke=r.findByProps("ContextMenuPopout");function Le(){return T.before("ContextMenuPopout",ke,function(e){const n=e[0]?.menu?.key;n!==void 0&&e[0]?.menu?.items?.length===3&&e[0].menu.items.push({label:"Reviews",action:function(){C.open(X,{userId:n})}})})}const{TableRow:v,TableSwitchRow:Ue,TableRowGroup:J}=r.findByProps("TableRow"),{Stack:Me}=r.findByProps("Stack");function ze(){N.useProxy(o.storage);const e=o.storage.authToken.length!==0;return t.React.createElement(Me,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},t.React.createElement(J,{title:"Authentication"},t.React.createElement(v,{label:"Authenticate with ReviewDB",icon:t.React.createElement(v.Icon,{source:u.getAssetIDByName("copy")}),arrow:!0,disabled:e,onPress:Y}),t.React.createElement(v,{variant:e?"danger":void 0,label:"Log out of ReviewDB",subLabel:"Note that this does not remove ReviewDB from your Authorized Apps page in Discord.",icon:t.React.createElement(v.Icon,{variant:e?"danger":void 0,source:u.getAssetIDByName("ic_leave_24px")}),disabled:!e,onPress:function(){return o.storage.authToken=""}})),t.React.createElement(J,{title:"Settings"},t.React.createElement(Ue,{label:"Use profile-themed send button",subLabel:"Controls whether the review send button should attempt to match the user's profile colors.",icon:t.React.createElement(v.Icon,{source:u.getAssetIDByName("ic_paint_brush")}),value:o.storage.useThemedSend,onValueChange:function(n){return o.storage.useThemedSend=n}})))}o.storage.authToken??="",o.storage.useThemedSend??=!0;const Oe=[Ce(),ge(),be(),xe(),Le()],B=[];L().then(function(e){return B.push(...e)});const Fe=function(){return Oe.forEach(function(e){return e()})};return g.admins=B,g.onUnload=Fe,g.settings=ze,g})({},vendetta.plugin,vendetta.metro,vendetta.ui,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.components,vendetta.ui.alerts,vendetta.ui.toasts,vendetta.ui.assets,vendetta.storage,vendetta);
